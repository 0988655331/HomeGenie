<div id="automation_command_domain_popup" data-role="popup" data-position-to="window" style="width:300px;">
	<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>				
	<div data-role="header">
        <h1>Wizard (1/4)</h1>
    </div>
	<div data-role="content" class="ui-corner-bottom ui-content">

	
        <div>
			<p data-locale-id="configure_program_selectcommandcontext" style="margin-top:-10px;font-weight:bold">Select command context</p>
	    	<p id="command_wizard_text" style="font-family:courier;font-size:9pt;margin:0px;height:70px;"></p>
        </div>    
  

		<ul id="automation_commandtarget" data-role="listview" data-inset="false" style="height:180px;max-height:180px;overflow-y:scroll;overflow-x:hidden;">
			<li data-context-value="HomeAutomation.HomeGenie"><a data-rel="popup" href="#automation_command_target_popup">HomeGenie</a></li>
            <li data-context-value="Controllers.LircRemote"><a data-rel="popup" href="#automation_command_target_popup">LircRemote</a></li>
		</ul>	
        							
	</div>	

	<div data-role="footer" data-tap-toggle="false">
		<div class="ui-grid-a">			
			<div class="ui-block-a">
                <a data-locale-id="configure_program_deletecancel" data-rel="back" data-role="button" data-icon="back" href="#">Cancel</a>
			</div>
		</div>
    </div>
        				
</div>		


	
<div id="automation_command_target_popup" data-role="popup" data-position-to="window" style="width:300px;">
	<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>				
	<div data-role="header">
        <h1>Wizard (2/4)</h1>
    </div>

	<div data-role="content" class="ui-corner-bottom ui-content">

        <div>
			<p data-locale-id="configure_program_selectcommandtarget" style="margin-top:-10px;font-weight:bold">Select command target</p>
	    	<p id="command_wizard_text" style="font-family:courier;font-size:9pt;margin:0px;height:70px;"></p>
        </div>    

		<ul id="automation_command_target" data-role="listview" data-inset="false" style="height:180px;max-height:180px;overflow-y:scroll;overflow-x:hidden;">
		</ul>
		
	</div>

	<div data-role="footer" data-tap-toggle="false">
		<div class="ui-grid-a">			
			<div class="ui-block-a">
				<a data-locale-id="configure_program_wizardback" data-rel="popup" data-role="button" data-icon="back" href="#automation_command_domain_popup">back</a>
			</div>
		</div>
    </div>

</div>			


	
<div id="automation_command_target_property" data-position-to="window" data-role="popup" style="width:300px;">
	<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>				
	<div data-role="header">
        <h1>Wizard (3/4)</h1>
    </div>
	
	<div data-role="content" class="ui-corner-bottom ui-content">

        <div>
			<p data-locale-id="configure_program_selectcommandtoperform" style="margin-top:-10px;font-weight:bold">Select command to perform</p>
	    	<p id="command_wizard_text" style="font-family:courier;font-size:9pt;margin:0px;height:70px;"></p>
        </div>    

		<ul id="automation_command_property" data-role="listview" data-inset="false" style="height:180px;max-height:180px;overflow-y:scroll;overflow-x:hidden;">
		</ul>
		
	</div>

	<div data-role="footer" data-tap-toggle="false">
		<div class="ui-grid-a">			
			<div class="ui-block-a">
				<a data-locale-id="configure_program_wizardback" data-rel="popup" data-role="button" data-icon="back" href="#automation_command_target_popup">back</a>
			</div>
		</div>
    </div>

</div>			
	


<div id="automation_command_args" data-position-to="window" data-role="popup" style="width:300px;">
	<a href="#" data-rel="back" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>				
	<div data-role="header">
        <h1>Wizard (4/4)</h1>
    </div>
	
	<div data-role="content" class="ui-corner-bottom ui-content">

        <div>
			<p data-locale-id="configure_program_commandarguments" style="margin-top:-10px;font-weight:bold">Command arguments</p>
	    	<p id="command_wizard_text" style="font-family:courier;font-size:9pt;margin:0px;height:70px;"></p>
        </div>    

		<ul data-role="listview" data-inset="false" style="height:180px;max-height:180px;">
			<li><input type="text" name="value" id="command_args_input" value="" placeholder="value" /></li>
		</ul>
		
	</div>

	<div data-role="footer" data-tap-toggle="false">
		<div class="ui-grid-a">			
			<div class="ui-block-a">
				<a data-locale-id="configure_program_wizardback" data-rel="popup" data-role="button" data-icon="back" href="#automation_command_target_property">back</a>
			</div>
			<div class="ui-block-b">
				<a data-locale-id="configure_program_wizarddone" id="command_completed" data-rel="popup" data-role="button" data-icon="check" href="#cancel">done</a>
			</div>
		</div>
    </div>

</div>			



<div data-role="popup" id="automation_capture_command_popup" data-position-to="window" style="width:250px;" class="ui-corner-all">
	<div data-role="header" class="ui-corner-top">
		<h1 data-locale-id="configure_program_commandcapturetitle">Capturing Commands</h1>
	</div>
	<div data-role="content" class="ui-corner-bottom ui-content">
		<h3 data-locale-id="configure_program_waitingnewcommand" class="ui-title">Waiting for new events...</h3>
		<p data-locale-id="configure_program_waitingnewcommandadvice"></p>
		<a data-locale-id="configure_program_deletecancel" href="#" data-role="button" data-inline="true" data-rel="back">Cancel</a>    
	</div>
</div>				



<div data-role="popup" id="automation_command_delete" style="max-width:400px;" class="ui-corner-all">
	<div data-role="header" class="ui-corner-top">
		<h1 data-locale-id="configure_program_deleteinstructiontitle">Delete Instruction?</h1>
	</div>
	<div data-role="content" class="ui-corner-bottom ui-content">
		<h3 class="ui-title" data-locale-id="configure_program_deleteinstructionprompt">Are you sure you want to delete this instruction statement?</h3>
		<p data-locale-id="configure_program_deleteadvice">This action cannot be undone.</p>
		<a data-locale-id="configure_program_deletecancel" href="#" data-role="button" data-inline="true" data-rel="back">Cancel</a>    
		<a data-locale-id="configure_program_deleteconfirm" id="command_delete_button" href="#" data-role="button" data-inline="true" data-rel="back" data-transition="flow">Delete</a>  
	</div>
</div>				
		
		
		
		
		
		

<script type="text/javascript">
//
var command_targetdomain = '';
var command_targetsubject = '';
var command_targetparameter = '';
var command_type = '';
var command_value = '';
var selected_command_index = -1;
//
$(document).ready(function (e) {

	// automation pop wizard popups
	$('[data-role=popup]').on('popupbeforeposition', function (event) {
		if (this.id == 'automation_command_domain_popup')
		{
			command_targetdomain = '';
			command_targetsubject = '';
			command_targetparameter = '';
			command_type = '';
			command_value = '';
			//
			$('#command_args_input').val('');
			//
			build_command();
		}
	});	        
	

	$('#automation_program_instructions').on('click', ' > li', function () {
		selected_command_index = $(this).index();
	});	
		
	$('#command_delete_button').bind('click', function (event) {
		if (selected_command_index >= 0)
		{
			HG.WebApp.ProgramEdit._CurrentProgram.Commands.splice(selected_command_index, 1);
			automationpage_CommandsRefresh();
		}
	});

	
	$('#automation_commandtarget').on('click', 'li', function() {
		command_targetdomain = $(this).attr('data-context-value');
		//
		$('#automation_command_target').listview().empty();
		//
		switch (command_targetdomain)
		{
			case 'HomeAutomation.HomeGenie':
			    $('#automation_command_target').append('<li data-theme="' + uitheme + '" data-context-value="Automation"><a data-rel="popup" href="#automation_command_target_property">Automation</a></li>');
			    break;
		    case 'Controllers.LircRemote':
		        $('#automation_command_target').append('<li data-theme="' + uitheme + '" data-context-value="IR"><a data-rel="popup" href="#automation_command_target_property">IR</a></li>');
		        break;
		    default:
//			case 'HomeAutomation.X10':
//			case 'HomeAutomation.ZWave':
				$('#automation_command_target').append(automationpage_GetCommandModulesListViewItems(command_targetdomain, false));
				break;
		}
		$('#automation_command_target').listview('refresh');
		//
		build_command();
	});

	$('#automation_command_target_popup').on('click', 'li', function() {
		command_targetsubject = $(this).attr('data-context-value');
		//
		$('#automation_command_property').listview().empty();
		//
		switch (command_targetdomain)
		{
			case 'HomeAutomation.HomeGenie':
			    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Program.Pause"><a data-rel="popup" href="#automation_command_args">Program.Pause</a></li>');
			    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Program.Repeat"><a data-rel="popup" href="#automation_command_args">Program.Repeat</a></li>');
			    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Groups.LightsOn"><a data-rel="popup" href="#automation_command_args">Groups.LightsOn</a></li>');
			    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Groups.LightsOff"><a data-rel="popup" href="#automation_command_args">Groups.LightsOff</a></li>');
//			    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Security.ArmedStatus"><a data-rel="popup" href="#automation_command_args">Security.ArmedStatus</a></li>');
			    break;
		    case 'Controllers.LircRemote':
		        $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Control.IrSend"><a data-rel="popup" href="#automation_command_args">Send IR code</a></li>');
		        break;
		    default:
//			case 'HomeAutomation.X10':
//			case 'HomeAutomation.ZWave':
				var module = HG.WebApp.Utility.GetModuleByDomainAddress(command_targetdomain, command_targetsubject);
				switch (module.DeviceType.toLowerCase())
				{
				case 'sensor':
				case 'temperature':
				case 'doorwindow':
				case 'thermostat':
				    break;
				case 'light':
				case 'switch':
				    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Control.On"><a data-rel="popup" href="#automation_command_args">Control.On</a></li>');
				    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Control.Off"><a data-rel="popup" href="#automation_command_args">Control.Off</a></li>');
				    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Control.Toggle"><a data-rel="popup" href="#automation_command_args">Control.Toggle</a></li>');
					break;
/*
				case 'siren':
				case 'dimmer':
				case 'shutter':
				case 'fan':*/
				default:
				    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Control.On"><a data-rel="popup" href="#automation_command_args">Control.On</a></li>');
				    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Control.Off"><a data-rel="popup" href="#automation_command_args">Control.Off</a></li>');
				    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Control.Level"><a data-rel="popup" href="#automation_command_args">Control.Level</a></li>');
				    $('#automation_command_property').append('<li data-theme="' + uitheme + '" data-context-value="Control.Toggle"><a data-rel="popup" href="#automation_command_args">Control.Toggle</a></li>');
					break;
				}
				break;
		}
		$('#automation_command_property').listview('refresh');
		//
		build_command();
	});

	$('#automation_command_target_property').on('click', 'li', function() {
		command_targetparameter = $(this).attr('data-context-value')
		build_command();
	});

	$('#command_completed').on('click', function() {
		command_value = $('#command_args_input').val();
	
		commandobj = { 
			'Domain' : command_targetdomain, 
			'Target' : command_targetsubject, 
			'CommandString' : command_targetparameter, 
			'CommandArguments' : command_value 
		};

		HG.WebApp.ProgramEdit._CurrentProgram.Commands.push( commandobj );
		
		automationpage_CommandsRefresh();
	
	});

});



function automationpage_GetCommandModulesListViewItems(domain, showall)
{
    var htmlopt = '';
    var mods = HG.WebApp.ProgramEdit.GetDomainControllableModules(domain, showall);
    for (var m = 0; m < mods.length; m++) {
        htmlopt += '<li data-theme="' + uitheme + '" data-context-domain="' + mods[m].Domain + '" data-context-value="' + mods[m].Address + '"><a data-rel="popup" href="#automation_command_target_property">' + mods[m].Address + ' (' + (mods[m].Name == null || mods[m].Name == '' ? mods[m].DeviceType : mods[m].Name) + ')' + '</a></li>'
    }
	return htmlopt;
}
		


function build_command(current)
{
	var commandstring = '... ?';
	
	if (command_targetdomain != '')
	{
		commandstring = command_targetdomain;
	}
	if (command_targetsubject != '')
	{
		commandstring += '.' + command_targetsubject;
	}
	if (command_targetparameter != '')
	{
		commandstring += '<br />&bull; <b>' + command_targetparameter + '</b>';
	}
	if (command_value != '')
	{
		commandstring += '<br />&bull; <b>' + command_value + '</b>';
	}
	$('body').find('[id=command_wizard_text]').each(function() { $(this).html(commandstring); });
	//return conditionstring;
}



function automationpage_CommandsRefresh()
{
	$('#automation_program_instructions').empty();
	for (i = 0; i < HG.WebApp.ProgramEdit._CurrentProgram.Commands.length; i++)
	{
	    var module = HG.WebApp.Utility.GetModuleByDomainAddress(HG.WebApp.ProgramEdit._CurrentProgram.Commands[i].Domain, HG.WebApp.ProgramEdit._CurrentProgram.Commands[i].Target);
	    var args = "";
	    if (HG.WebApp.ProgramEdit._CurrentProgram.Commands[i].CommandArguments != 'undefined')
	    {
	        args = HG.WebApp.ProgramEdit._CurrentProgram.Commands[i].CommandArguments;
	    }
		$('#automation_program_instructions').append('' +
			'<li data-theme="' + uitheme + '" data-context-value="' + i + '"><a>' +
			' <span style="color:gray">' + HG.WebApp.ProgramEdit._CurrentProgram.Commands[i].Domain.split('.')[1] + '</span>' +
			' ' + HG.WebApp.ProgramEdit._CurrentProgram.Commands[i].Target + (module ? ' <span style="color:gray">' + module.DeviceType  + '</span>' : ' <span style="color:gray">do</span>') +
			' <b>' + HG.WebApp.ProgramEdit._CurrentProgram.Commands[i].CommandString.split('.')[1].toUpperCase() + '</b>' +
			' ' +
			'<b>' + args + '</b>' +
			'</a><a data-theme="' + uitheme + '" style="border:0;-moz-border-radius: 0px;-webkit-border-radius: 0px;border-radius: 0px" data-rel="popup" data-position-to="window" data-role="button" data-transition="pop" href="#automation_command_delete">--</a></li>');
	}            	
	$('#automation_program_instructions').listview('refresh');
}

</script>
