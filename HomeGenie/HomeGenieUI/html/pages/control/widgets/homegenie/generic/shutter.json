[{
    Name: "Generic Shutter",
    Author: "Gene",
    Version: "2013-04-03",

	GroupName : '',
	IconImage : 'pages/control/widgets/homegenie/generic/images/shutters_open.png',
	StatusText : '',
	Description : '',
    UpdateTime : '',

    RenderView: function (cuid, module) {
		var container = $(cuid);
		var widget = container.find('[data-ui-field=widget]');
		var controlpopup = widget.data('ControlPopUp');
		var invertcontrols = false;
		//
		// create and store a local reference to control popup object
		//
		if (!controlpopup)
		{
			container.find('[data-ui-field=controlpopup]').trigger('create');
			controlpopup = container.find('[data-ui-field=controlpopup]').popup();
			widget.data('ControlPopUp',  controlpopup);
			//
			// initialization stuff here
			//
			// when widget is clicked control popup is shown
			widget.on('click', function() {
				if ($(cuid).find('[data-ui-field=widget]').data('ControlPopUp'))
				{
					$(cuid).find('[data-ui-field=widget]').data('ControlPopUp').popup('open');
				}
			});
			//
			// level knob
			//
			controlpopup.find('[data-ui-field=level_knob]').knob({
				'release' : function (v) 
				{
					v = Math.round(v);
					HG.Control.Modules.ServiceCall("Control.Level", module.Domain, module.Address, v, function (data) { });
				},
				'change' : function (v)
				{
					v = Math.round(v);
					controlpopup.find('[data-ui-field=status]').html(v + '%');
				}
            });
			//
			// ui events handlers
			//
			// toggle button action
			container.find('[data-ui-field=toggle]').on('click', function(){
				HG.Control.Modules.ServiceCall("Control.Toggle", module.Domain, module.Address, null, function (data) { });
			});
			controlpopup.find('[data-ui-field=close_button]').on('click', function(){
                var cmd = 'Control.Off';
                if (invertcontrols) cmd = 'Control.On';
                HG.Control.Modules.ServiceCall(cmd, module.Domain, module.Address, '', function (data) { });
			});
			controlpopup.find('[data-ui-field=open_button]').on('click', function(){
                var cmd = 'Control.On';
                if (invertcontrols) cmd = 'Control.Off';
                HG.Control.Modules.ServiceCall(cmd, module.Domain, module.Address, '', function (data) { });
			});
		}
		//
		// read some context data
		//
		this.GroupName = container.attr('data-context-group');
		//
		// read module status prop
		//
        var status = HG.WebApp.Utility.GetModulePropertyByName(module, "Status.Level");
		var level = 0;
        if (status != null)
        {
			level = status.Value.replace(',', '.') * 100;
            var updatetime = status.UpdateTime;
			if (typeof updatetime != 'undefined')
			{
				updatetime = updatetime.replace(' ', 'T'); // fix for IE and FF
				var d = new Date(updatetime);
				this.UpdateTime = HG.WebApp.Utility.FormatDate(d) + '<br>' + HG.WebApp.Utility.FormatDateTime(d); //HG.WebApp.Utility.GetElapsedTimeText(d);
			}
            //
            if ((invertcontrols && level != 1) || level > 0) 
            {
			    this.StatusText = 'Open';
			    this.IconImage = 'pages/control/widgets/homegenie/generic/images/shutters_open.png';
		    }
		    else
		    {
			    this.StatusText = 'Closed';
			    this.IconImage = 'pages/control/widgets/homegenie/generic/images/shutters_closed.png';
		    }
        }
        else
        {
			    this.StatusText = '?';
			    this.IconImage = 'pages/control/widgets/homegenie/generic/images/shutters_closed.png';
        }
		this.Description = (module.Domain.substring(module.Domain.lastIndexOf('.') + 1)) + ' <strong>' + module.Address + '</strong>';
		//
		// render widget
		//
        widget.find('[data-ui-field=name]').html(module.Name);
		widget.find('[data-ui-field=description]').html(this.Description);
		widget.find('[data-ui-field=status]').html(this.StatusText.toUpperCase());
		widget.find('[data-ui-field=icon]').attr('src', this.IconImage);
        widget.find('[data-ui-field=updatetime]').html(this.UpdateTime);
		//
		// render control popup
		//
		controlpopup.find('[data-ui-field=icon]').attr('src', this.IconImage);
		controlpopup.find('[data-ui-field=group]').html(this.GroupName);
		controlpopup.find('[data-ui-field=name]').html(module.Name);
		controlpopup.find('[data-ui-field=status]').html(this.StatusText);
		controlpopup.find('[data-ui-field=level_knob]').val(Math.round(level)).trigger('change');
    }

}]